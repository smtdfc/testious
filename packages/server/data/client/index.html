<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Testious | Client Test Runner</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined&family=Inter:wght@400;600&display=swap"
    />
    <style>
      * {
        --primary-color: #0d6efd;
        --secondary-color: #6c757d;
        --info-color: #0dcaf0;
        --success-color: #198754;
        --warn-color: #ffc107;
        --danger-color: #dc3545;
        --light-color: #f8f9fa;
        --dark-color: #212529;
        --on-primary-color: #ffffff;
        --on-secondary-color: #ffffff;
        --on-info-color: #000000;
        --on-success-color: #ffffff;
        --on-warn-color: #212529;
        --on-danger-color: #ffffff;
        --on-light-color: #212529;
        --on-dark-color: #ffffff;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', Arial, sans-serif;
        background: var(--light-color);
        color: var(--on-light-color);
      }

      nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-sizing: border-box;
        padding: 1rem 2rem;
        background: var(--primary-color);
        color: var(--on-primary-color);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        z-index: 10;
      }

      nav > .btn {
        margin: 0;
      }

      nav h3 {
        font-weight: 600;
        margin: 0;
        font-size: 1.3rem;
      }

      .btn {
        --btn-bg: var(--transparent);
        --btn-color: var(--main-color);
        --btn-border-color: var(--btn-bg);
        background: var(--btn-bg);
        color: var(--btn-color);
        padding: 0.5rem;
        margin: 0.5rem;
        transition: ease 0.3s all;
        border: solid 1.5px var(--btn-border-color);
        border-radius: 5px;
      }

      .btn-primary {
        --btn-bg: var(--primary-color);
        --btn-color: var(--on-primary-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-secondary {
        --btn-bg: var(--secondary-color);
        --btn-color: var(--on-secondary-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-info {
        --btn-bg: var(--info-color);
        --btn-color: var(--on-info-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-success {
        --btn-bg: var(--success-color);
        --btn-color: var(--on-success-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-warn {
        --btn-bg: var(--warn-color);
        --btn-color: var(--on-warn-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-danger {
        --btn-bg: var(--danger-color);
        --btn-color: var(--on-danger-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-light {
        --btn-bg: var(--light-color);
        --btn-color: var(--on-light-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-dark {
        --btn-bg: var(--dark-color);
        --btn-color: var(--on-dark-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-outline-primary {
        --btn-bg: transparent;
        --btn-color: var(--primary-color);
        --btn-border-color: var(--primary-color);
      }

      .btn-outline-primary:hover {
        --btn-bg: var(--primary-color);
        --btn-color: var(--on-primary-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-primary:disabled {
        --btn-bg: var(--primary-color);
        --btn-color: var(--on-primary-color);
        --btn-border-color: var(--primary-color);
      }

      .btn-outline-primary:disabled {
        --btn-bg: var(--primary-color);
        --btn-color: var(--on-primary-color);
        --btn-border-color: var(--primary-color);
      }

      .btn-outline-secondary {
        --btn-bg: transparent;
        --btn-color: var(--secondary-color);
        --btn-border-color: var(--secondary-color);
      }

      .btn-outline-secondary:hover {
        --btn-bg: var(--secondary-color);
        --btn-color: var(--on-secondary-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-secondary:disabled {
        --btn-bg: var(--secondary-color);
        --btn-color: var(--on-secondary-color);
        --btn-border-color: var(--secondary-color);
      }

      .btn-outline-secondary:disabled {
        --btn-bg: var(--secondary-color);
        --btn-color: var(--on-secondary-color);
        --btn-border-color: var(--secondary-color);
      }

      .btn-outline-info {
        --btn-bg: transparent;
        --btn-color: var(--info-color);
        --btn-border-color: var(--info-color);
      }

      .btn-outline-info:hover {
        --btn-bg: var(--info-color);
        --btn-color: var(--on-info-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-info:disabled {
        --btn-bg: var(--info-color);
        --btn-color: var(--on-info-color);
        --btn-border-color: var(--info-color);
      }

      .btn-outline-info:disabled {
        --btn-bg: var(--info-color);
        --btn-color: var(--on-info-color);
        --btn-border-color: var(--info-color);
      }

      .btn-outline-success {
        --btn-bg: transparent;
        --btn-color: var(--success-color);
        --btn-border-color: var(--success-color);
      }

      .btn-outline-success:hover {
        --btn-bg: var(--success-color);
        --btn-color: var(--on-success-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-success:disabled {
        --btn-bg: var(--success-color);
        --btn-color: var(--on-success-color);
        --btn-border-color: var(--success-color);
      }

      .btn-outline-success:disabled {
        --btn-bg: var(--success-color);
        --btn-color: var(--on-success-color);
        --btn-border-color: var(--success-color);
      }

      .btn-outline-warn {
        --btn-bg: transparent;
        --btn-color: var(--warn-color);
        --btn-border-color: var(--warn-color);
      }

      .btn-outline-warn:hover {
        --btn-bg: var(--warn-color);
        --btn-color: var(--on-warn-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-warn:disabled {
        --btn-bg: var(--warn-color);
        --btn-color: var(--on-warn-color);
        --btn-border-color: var(--warn-color);
      }

      .btn-outline-warn:disabled {
        --btn-bg: var(--warn-color);
        --btn-color: var(--on-warn-color);
        --btn-border-color: var(--warn-color);
      }

      .btn-outline-danger {
        --btn-bg: transparent;
        --btn-color: var(--danger-color);
        --btn-border-color: var(--danger-color);
      }

      .btn-outline-danger:hover {
        --btn-bg: var(--danger-color);
        --btn-color: var(--on-danger-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-danger:disabled {
        --btn-bg: var(--danger-color);
        --btn-color: var(--on-danger-color);
        --btn-border-color: var(--danger-color);
      }

      .btn-outline-danger:disabled {
        --btn-bg: var(--danger-color);
        --btn-color: var(--on-danger-color);
        --btn-border-color: var(--danger-color);
      }

      .btn-outline-light {
        --btn-bg: transparent;
        --btn-color: var(--light-color);
        --btn-border-color: var(--light-color);
      }

      .btn-outline-light:hover {
        --btn-bg: var(--light-color);
        --btn-color: var(--on-light-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-light:disabled {
        --btn-bg: var(--light-color);
        --btn-color: var(--on-light-color);
        --btn-border-color: var(--light-color);
      }

      .btn-outline-light:disabled {
        --btn-bg: var(--light-color);
        --btn-color: var(--on-light-color);
        --btn-border-color: var(--light-color);
      }

      .btn-outline-dark {
        --btn-bg: transparent;
        --btn-color: var(--dark-color);
        --btn-border-color: var(--dark-color);
      }

      .btn-outline-dark:hover {
        --btn-bg: var(--dark-color);
        --btn-color: var(--on-dark-color);
        --btn-border-color: var(--btn-bg);
      }

      .btn-dark:disabled {
        --btn-bg: var(--dark-color);
        --btn-color: var(--on-dark-color);
        --btn-border-color: var(--dark-color);
      }

      .btn-outline-dark:disabled {
        --btn-bg: var(--dark-color);
        --btn-color: var(--on-dark-color);
        --btn-border-color: var(--dark-color);
      }

      .btn-icon {
        --btn-border-color: transparent;
        border-radius: 100%;
      }

      .btn-icon:hover {
        --btn-bg: var(--main-hover-color);
      }

      .btn-icon-text {
        display: flex;
        align-items: center;
      }

      .btn:disabled {
        opacity: 0.6;
        pointer-events: none;
      }

      .container {
        margin-top: 6rem;
        padding: 1rem;
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
      }

      .accordion {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        margin-bottom: 1rem;
        transition: all 0.3s ease;
      }

      .accordion-header {
        padding: 0.8rem 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
      }

      .accordion-title {
        margin: 0;
        font-weight: 600;
        font-size: 1rem;
        color: var(--dark-color);
      }

      .accordion-toggle-btn {
        background: none;
        border: none;
        cursor: pointer;
        transition: transform 0.3s ease;
        font-size: 1.5rem;
        color: var(--dark-color);
      }

      .accordion-body {
        display: none;
        overflow: hidden;
        transition:
          max-height 0.4s ease,
          padding 0.3s ease;
        padding: 0 1rem;
      }

      .accordion.active .accordion-body {
        display: block;
        padding: 1rem;
      }

      .accordion.active .accordion-toggle-btn {
        transform: rotate(180deg);
      }

      .table-container {
        max-width: 100%;
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 8px;
        overflow: hidden;
      }

      table thead tr {
        background-color: var(--primary-color);
        color: white;
        text-align: left;
        font-weight: 600;
      }

      table th,
      table td {
        padding: 12px 16px;
        border-bottom: 1px solid #eee;
      }

      table tbody tr:hover {
        background-color: #f8faff;
      }

      .badge {
        display: inline-block;
        padding: 0.25rem 0.6rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
      }

      .badge-success {
        background: var(--success-color);
        color: var(--on-success-color);
      }

      .badge-danger {
        background: var(--danger-color);
        color: var(--on-danger-color);
      }

      .badge-warn {
        background: var(--warn-color);
        color: var(--on-warn-color);
      }

      .no-test {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem 0;
        color: #888;
        font-size: 0.95rem;
        animation: fadeIn 0.4s ease-in-out;
      }

      .no-test span {
        font-size: 2rem;
        margin-bottom: 0.3rem;
        opacity: 0.7;
        animation: pulseIcon 1s ease-in-out infinite;
      }

      .no-test p {
        margin: 0;
        font-style: italic;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulseIcon {
        0%,
        100% {
          transform: scale(1);
        }

        50% {
          transform: scale(1.15);
        }
      }

      #console {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #1e1e1e;
        color: #d4d4d4;
        font-family: monospace;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.4);
        transition: transform 0.3s ease-in-out;
        border-top: 1px solid #333;
      }

      /* Chiều cao khi mở */
      #console:not(.closed) {
        transform: translateY(0);
        height: 35vh;
      }

      #console.closed {
        transform: translateY(calc(100% - 30px));
        height: 35vh;
      }

      .console-header {
        height: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 0.5rem;
        background: #252526;
        border-bottom: 1px solid #333;
        cursor: pointer;
        user-select: none;
      }

      .console-header span {
        font-weight: bold;
      }

      .console-header button {
        background: none;
        border: none;
        color: #ccc;
        font-size: 14px;
        cursor: pointer;
      }

      .console-body {
        height: calc(100% - 30px);
        overflow-y: auto;
        padding: 0.5rem;
        white-space: pre-wrap;
      }

      .console-body::-webkit-scrollbar {
        width: 8px;
      }

      .console-body::-webkit-scrollbar-thumb {
        background: #555;
        border-radius: 4px;
      }
    </style>
  </head>

  <body>
    <nav>
      <h3>Testious</h3>
      <button
        id="navbar-console-toggle"
        class="btn btn-icon material-symbols-outlined"
      >
        terminal
      </button>
    </nav>

    <div class="container" id="container">
      <span class="no-test-row" id="fallback">
        <td colspan="3">
          <div class="no-test">
            <span class="material-symbols-outlined">hourglass_empty</span>
            <p>No test cases yet</p>
          </div>
        </td>
      </span>
    </div>
    <div id="console" class="console-sheet closed">
      <div class="console-header">
        <span>Console</span>
        <button id="console-toggle">▼</button>
      </div>
      <div class="console-body" id="console-output"></div>
    </div>
    <script type="module">
      const consoleEl = document.getElementById('console');
      const toggleBtn = document.getElementById('console-toggle');
      const outputEl = document.getElementById('console-output');
      const navbarToggleConsoleBtn = document.getElementById(
        'navbar-console-toggle',
      );

      navbarToggleConsoleBtn.addEventListener('click', () => {
        consoleEl.classList.toggle('closed');
        toggleBtn.textContent = consoleEl.classList.contains('closed')
          ? '▲'
          : '▼';
      });

      toggleBtn.addEventListener('click', () => {
        consoleEl.classList.toggle('closed');
        toggleBtn.textContent = consoleEl.classList.contains('closed')
          ? '▲'
          : '▼';
      });

      function appendLog(type, args) {
        const line = document.createElement('div');
        line.className = `log-line ${type}`;
        line.textContent = args
          .map((a) =>
            typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a),
          )
          .join(' ');
        outputEl.appendChild(line);
        outputEl.scrollTop = outputEl.scrollHeight;
      }

      ['log', 'warn', 'error', 'info'].forEach((type) => {
        const original = console[type];
        console[type] = (...args) => {
          appendLog(type, args);
          original.apply(console, args);
        };
      });

      class Accordion {
        constructor(element) {
          this.element = element;
          this.header =
            element.querySelector('.accordion-header') ??
            document.createElement('span');
          this.init();
        }
        init() {
          this.header.addEventListener('click', () => this.toggle());
        }
        open() {
          this.element.classList.add('active');
        }
        close() {
          this.element.classList.remove('active');
        }
        toggle() {
          this.element.classList.toggle('active');
        }
      }

      window.TESTIOUS_DISPLAY_HELPER = {
        groups: {},
        groupIDMap: {},
        addGroup: function (id, description) {
          let fallback = document.querySelector('#fallback');
          if (fallback) fallback.innerHTML = '';
          this.groups[id] = document.createElement('div');
          document.getElementById('container').appendChild(this.groups[id]);
          this.groupIDMap[id] = Date.now().toString(32);
          this.groups[id].innerHTML = `
        <div class="accordion" id="accordion_${this.groupIDMap[id]}">
          <div class="accordion-header">
            <h3 class="accordion-title">Group: ${description}</h3>
            <button class="accordion-toggle-btn material-symbols-outlined">keyboard_arrow_down</button>
          </div>
          <div class="accordion-body">
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Case</th>
                    <th>Description</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="${this.groupIDMap[id]}"></tbody>
              </table>
            </div>
          </div>
        </div>
      `;
          new Accordion(
            document.getElementById(`accordion_${this.groupIDMap[id]}`),
          );
        },
        addCase: function (groupID, caseID, description, status) {
          let groupEle = document.getElementById(this.groupIDMap[groupID]);
          let element = document.createElement('tr');
          element.dataset.caseId = caseID;
          let badgeClass = this._getBadgeClass(status);
          element.innerHTML = `
          <td>#${caseID}</td>
          <td>${description}</td>
          <td><span class="badge ${badgeClass}">${status}</span></td>
        `;
          groupEle.appendChild(element);
        },
        updateCaseStatus: function (groupID, caseID, newStatus) {
          let groupEle = document.getElementById(this.groupIDMap[groupID]);
          let row = [...groupEle.querySelectorAll('tr')].find(
            (tr) => tr.dataset.caseId == caseID,
          );
          if (row) {
            let badge = row.querySelector('.badge');
            badge.textContent = newStatus;
            badge.className = 'badge ' + this._getBadgeClass(newStatus);
          }
        },
        _getBadgeClass: function (status) {
          return status === 'passed'
            ? 'badge-success'
            : status === 'failed'
              ? 'badge-danger'
              : 'badge-warn';
        },
      };
      console.log('Welcome to Testious [', window.navigator.userAgent, ']');
    </script>
    <script src="./browser.runner.js" type="module" charset="utf-8"></script>
  </body>
</html>
